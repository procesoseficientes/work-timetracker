<h2>Track</h2>
<form method="POST">
  <div class="form-group">
    <label for="owner">Task owner</label>
    <select onchange="loadProject()" name="owner" class="form-control bg-dark text-light">
      {{#each owners}}
        <option value="{{this.id}}">{{this.name}}</option>
      {{/each}}
    </select>
  </div>

  <div id="project-container" class="form-group">
    <label for="project">Project</label>
    <select id="project" name="project" class="form-control bg-dark text-light">
    </select>
  </div>

  <div class="form-group">
    <label for="task">Task</label>
    <input type="text" class="form-control bg-dark text-light" name="task" placeholder="Enter task">
  </div>

  <button type="submit" class="btn btn-primary">Track</button>
</form>

<br/>

<h2>Timeline</h2>
<div class="progress" style="height: 35px;">
   {{#each this.times}}
    <div 
      class="progress-bar {{this.color}} {{#if this.current}}progress-bar-animated progress-bar-striped{{/if}}" 
      role="progressbar" 
      style="width: {{this.percent}}%" 
      aria-valuenow="20" 
      aria-valuemin="0" 
      aria-valuemax="100"
    >
      {{this.owner}} ({{this.hours}}h)
    </div>
    {{/each}}
</div>
<br>
{{#if isWorking}}<button onclick="stopTracking()" class="btn btn-danger">Stop Tracking</button>{{/if}}

<script>
  function loadProject() {
    const owner = document.getElementsByName('owner')[0].value
    fetch(`/projects/api?ownerId=${owner}`).then(async data => {
      data = await data.json()
      let projectsOption = data.reduce((a, b) => {
        return a + `<option value="${b.id}">${b.name}</option>`
      }, '')

      document.getElementById('project').innerHTML = projectsOption
    })
  }

  function stopTracking() {
    fetch('/', {
      method: 'delete',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ id: {{userId}} })
    }).then(() => {
      window.location.replace('/')
    })
  }

  loadProject()
</script>